<!DOCTYPE html>
<html>

<head>
    <title>Geolocation</title>
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no">
    <meta charset="utf-8">
    <style>
        /* Always set the map height explicitly to define the size of the div
       * element that contains the map. */
        #map {
            height: 400px;
            width: 400px;
        }

        /* Optional: Makes the sample page fill the window. */
        html,
        body {
            height: 100%;
            margin: 10px;
            padding: 0;
        }
    </style>
</head>

<body>
    <div id="map"></div>
    <button id="get">Get directions</button>
    <script>
        // Note: This example requires that you consent to location sharing when
        // prompted by your browser. If you see the error "The Geolocation service
        // failed.", it means you probably did not give permission for the browser to
        // locate you.
        
        
        
        
        var map
        
        // GEO
        , infoWindow;

        
       

        function initMap() {
            var directionsDisplay = new google.maps.DirectionsRenderer();
            var directionsService = new google.maps.DirectionsService();
            

            var disneyWorld = new google.maps.LatLng('28.3852','81.5639');
            var miami = new google.maps.LatLng('25.761681','-80.191788');
              
            map = new google.maps.Map(document.getElementById('map'), {
                center: {lat: 25.761681, lng: -80.191788}  ,
                zoom: 15
            });
            
            infoWindow = new google.maps.InfoWindow;
            
        
            var $pos;

            // Try HTML5 geolocation.
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(function (position) {
                    var pos = {
                        lat: position.coords.latitude,
                        lng: position.coords.longitude
                    };
                    


                    infoWindow.setPosition(pos);
                    infoWindow.setContent('You are here.');
                    infoWindow.open(map);
                    map.setCenter(pos);
                    // pushes the current lat and lng to to a globar variable
                    $pos = pos
                    console.log($pos);

                }, function () {
                    handleLocationError(true, infoWindow, map.getCenter());
                });
            } else {
                // Browser doesn't support Geolocation
                handleLocationError(false, infoWindow, map.getCenter());
            }


            
        
    //   ROUTING REQUEST
        directionsDisplay.setMap(map);

        function calculateRoute(){

        // input locations here ( need to check why it won get the coordinates)
            var request = {
                origin:  {location: $pos},
                destination: {placeId: "ChIJs2LmmbgQhIARMlmj6BLNK_I"},
                travelMode: 'DRIVING'
            };
// displays the locations object in map
            directionsService.route(request, function(result, status){
           console.log(result, status);
                  if( status == "OK"){
                  directionsDisplay.setDirections(result);
              }
            })
        }
// activates the button
        document.getElementById('get').onclick= function(){
            calculateRoute();
        };

        // non browser support
        function handleLocationError(browserHasGeolocation, infoWindow, pos) {
            infoWindow.setPosition(pos);
            infoWindow.setContent(browserHasGeolocation ?
                'Error: The Geolocation service failed.' :
                'Error: Your browser doesn\'t support geolocation.');
            infoWindow.open(map);
        }

    }
    </script>



    <script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCUM6ziq10bpobC1rqrO3O9LGJwgzUTJEA&callback=initMap">
    </script>
</body>

</html>